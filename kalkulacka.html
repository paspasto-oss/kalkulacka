<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Profi Kalkulačka – Plyn vs. Tepelné čerpadlo</title>

<style>
  :root{ --brand:#D60000; --dark:#111; --bg:#F6F7F9; --success:#28a745; }
  html,body{margin:0;padding:0;font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:#f0f2f5;color:#111;line-height:1.5}
  .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
  .frame{background:#fff;border:1px solid #e6e6e6;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:24px}

  .grid{display:grid;grid-template-columns:1fr;gap:20px}
  @media(min-width:980px){ .grid{grid-template-columns:1fr 1fr} }
  
  .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:20px;transition:0.3s}
  .card:hover{border-color:#ccc}
  
  h2{font-size:19px;margin:0 0 15px 0;color:var(--brand);border-bottom:2px solid #f0f0f0;padding-bottom:8px}
  label{display:block;font-weight:600;margin-top:12px;font-size:14px}
  input, select{width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;font-size:15px;margin-top:5px;box-sizing:border-box}
  input:focus{border-color:var(--brand);outline:none;box-shadow:0 0 0 3px rgba(214,0,0,0.1)}
  
  .muted{color:#777;font-size:12px;margin-top:4px}
  table{width:100%;border-collapse:collapse;margin-top:15px}
  th,td{padding:12px 8px;border-bottom:1px solid #f0f0f0;text-align:left;font-size:14px}
  .right{text-align:right;font-weight:600}
  
  .kpi{display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px;margin-top:15px}
  .box{background:var(--bg);border:1px solid #e8e8e8;border-radius:12px;padding:15px;text-align:center}
  .box b{display:block;font-size:11px;text-transform:uppercase;color:#666;margin-bottom:5px}
  .box span{font-size:22px;font-weight:800;color:var(--dark)}
  .box.highlight{background:#eefdf3;border-color:#c3e6cb}
  .box.highlight span{color:var(--success)}

  .cta{margin-top:25px;display:flex;gap:12px;flex-wrap:wrap}
  .btn{flex:1;min-width:160px;background:var(--brand);border:none;color:#fff;padding:14px;border-radius:10px;font-weight:800;text-transform:uppercase;cursor:pointer;transition:0.2s;text-align:center}
  .btn:hover{filter:brightness(1.1);transform:translateY(-1px)}
  .btn.secondary{background:#444}
  .btn.pdf{background:var(--success)}

  @media print{ .cta, input, select { display:none !important; } }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>

<div class="wrap">
  <div class="frame" id="exportArea">
    <div style="text-align:center;margin-bottom:20px">
        <h1 style="margin:0;font-size:24px">Porovnanie nákladov na vykurovanie</h1>
        <p style="color:#666;margin:5px 0">Plyn vs. Tepelné čerpadlo (TČ)</p>
    </div>

    <div class="grid">
      <div class="card">
        <h2>1. Plynové vykurovanie</h2>
        <label>Ročná spotreba plynu (m³)</label>
        <input id="gas_m3" type="number" value="1800">
        
        <label>Účinnosť kotla (%)</label>
        <input id="boiler_eff" type="number" value="95">
        <div class="muted">Kondenzačný: 95-105% | Starý: 80-85%</div>

        <label>Cena plynu (€/m³ s DPH)</label>
        <input id="gas_price" type="number" step="0.01" value="0.75">

        <label>Servis a revízie (€/rok)</label>
        <input id="gas_service" type="number" value="80">
        <div class="muted">Revízia kotla a komína</div>
      </div>

      <div class="card">
        <h2>2. Tepelné čerpadlo</h2>
        <label>Sezónne COP (SCOP)</label>
        <select id="scop">
          <option value="3.0">3.0 (Radiátory)</option>
          <option value="3.5" selected>3.5 (Mix / Starší dom)</option>
          <option value="4.0">4.0 (Podlahovka / Novostavba)</option>
          <option value="4.5">4.5 (Top efektivita)</option>
        </select>

        <label>Cena elektriny (€/kWh s DPH)</label>
        <input id="elec_price" type="number" step="0.001" value="0.18">

        <label>Vlastná elektrina z FVE (%)</label>
        <input id="pv" type="number" min="0" max="100" value="0">

        <label>Ročný servis TČ (€/rok)</label>
        <input id="hp_service" type="number" value="50">
      </div>

      <div class="card" style="grid-column:1/-1">
        <h2>Výsledky a ekonomika</h2>
        
        <div class="kpi">
          <div class="box"><b>Užitočné teplo</b><span id="heat_kwh">0 kWh</span></div>
          <div class="box"><b>Spotreba TČ</b><span id="hp_kwh">0 kWh</span></div>
          <div class="box highlight"><b>Ročná úspora</b><span id="savings">0 €</span></div>
          <div class="box"><b>Úspora CO₂</b><span id="co2">0 kg</span></div>
        </div>

        <table>
          <tbody id="rows"></tbody>
          <tfoot>
            <tr style="background:#f9f9f9">
              <td><strong>Ročné náklady celkom (Plyn)</strong></td>
              <td class="right" id="gas_total" style="color:var(--brand)">0 €</td>
            </tr>
            <tr style="background:#f9f9f9">
              <td><strong>Ročné náklady celkom (TČ)</strong></td>
              <td class="right" id="hp_total" style="color:var(--success)">0 €</td>
            </tr>
          </tbody>
        </table>

        <div style="margin-top:20px; padding:15px; background:var(--bg); border-radius:10px">
            <h3 style="margin:0 0 10px 0; font-size:16px">Návratnosť investície</h3>
            <div class="grid" style="grid-template-columns: 1fr 1fr; gap:15px">
                <div>
                    <label>Čistá investícia do TČ (€)</label>
                    <input id="net_invest" type="number" placeholder="Cena po odrátaní dotácie" value="5000">
                </div>
                <div>
                    <label>Doba návratnosti</label>
                    <div id="payback_ui" style="font-size:24px; font-weight:800; margin-top:10px; color:var(--brand)">–</div>
                </div>
            </div>
        </div>

        <div class="cta" id="buttonsRow">
          <button class="btn pdf" id="pdfBtn">Stiahnuť PDF report</button>
          <button class="btn secondary" id="resetBtn">Resetovať</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
    // KONFIGURÁCIA FIRMY PRE PDF
    const CONFIG = {
        name: "SPEKTRA INSTALL",
        contact: "+421 917 572 221 | spektrainstall@gmail.com",
        web: "www.spektrainstall.sk",
        logo: "https://michpas69.github.io/kalkulacka/1customcolor_logo_transparent_background.png"
    };

    const el = id => document.getElementById(id);
    const fmt = n => n.toLocaleString('sk-SK', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' €';

    function calculate() {
        // Vstupy
        const gas_m3 = +el('gas_m3').value || 0;
        const eff = (+el('boiler_eff').value || 95) / 100;
        const gas_p = +el('gas_price').value || 0;
        const gas_s = +el('gas_service').value || 0;
        
        const scop = +el('scop').value || 3.5;
        const elec_p = +el('elec_price').value || 0.18;
        const pv_share = (+el('pv').value || 0) / 100;
        const hp_s = +el('hp_service').value || 0;
        const invest = +el('net_invest').value || 0;

        // Výpočty Plyn
        const gas_energy_kwh = gas_m3 * 10.55; // priemerná výhrevnosť
        const useful_heat = gas_energy_kwh * eff;
        const gas_year_cost = (gas_m3 * gas_p) + (5 * 12) + gas_s; // plyn + fix (60€) + servis

        // Výpočty TČ
        const hp_cons_kwh = useful_heat / scop;
        const hp_paid_kwh = hp_cons_kwh * (1 - pv_share);
        const hp_year_cost = (hp_paid_kwh * elec_p) + hp_s;

        // Úspory a emisie
        const annual_savings = Math.max(0, gas_year_cost - hp_year_cost);
        const co2_saved = (gas_energy_kwh * 0.202) - (hp_paid_kwh * 0.160); // orientačné kg CO2

        // Update UI
        el('heat_kwh').textContent = Math.round(useful_heat).toLocaleString() + ' kWh';
        el('hp_kwh').textContent = Math.round(hp_cons_kwh).toLocaleString() + ' kWh';
        el('savings').textContent = Math.round(annual_savings).toLocaleString() + ' €';
        el('co2').textContent = Math.round(co2_saved).toLocaleString() + ' kg';
        
        el('gas_total').textContent = fmt(gas_year_cost);
        el('hp_total').textContent = fmt(hp_year_cost);

        // Tabuľka detailov
        const rows = [
            ['Energia v plyne', Math.round(gas_energy_kwh) + ' kWh'],
            ['Náklady na plyn (komodita)', fmt(gas_m3 * gas_p)],
            ['Paušálne poplatky a servis', fmt(60 + gas_s)],
            ['Spotreba elektriny TČ', Math.round(hp_cons_kwh) + ' kWh'],
            ['Úspora vďaka FVE', pv_share > 0 ? '-' + fmt(hp_cons_kwh * pv_share * elec_p) : '0 €'],
            ['Servisné náklady TČ', fmt(hp_s)]
        ];
        el('rows').innerHTML = rows.map(r => `<tr><td>${r[0]}</td><td class="right">${r[1]}</td></tr>`).join('');

        // Návratnosť
        if(invest > 0 && annual_savings > 0) {
            const years = invest / annual_savings;
            el('payback_ui').textContent = years.toFixed(1).replace('.', ',') + ' r.';
        } else {
            el('payback_ui').textContent = '–';
        }
    }

    // PDF Export
    async function downloadPDF() {
        const btnRow = el('buttonsRow');
        btnRow.style.opacity = '0';
        
        const canvas = await html2canvas(el('exportArea'), { scale: 2 });
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        
        const imgData = canvas.toDataURL('image/png');
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth() - 20;
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

        pdf.addImage(imgData, 'PNG', 10, 10, pdfWidth, pdfHeight);
        
        // Päta PDF
        pdf.setFontSize(9);
        pdf.setTextColor(150);
        pdf.text(`${CONFIG.name} | ${CONFIG.contact} | ${CONFIG.web}`, 10, 285);
        
        pdf.save('Vypocet_Spektra_Install.pdf');
        btnRow.style.opacity = '1';
    }

    // Eventy
    const inputs = ['gas_m3','boiler_eff','gas_price','gas_service','scop','elec_price','pv','hp_service','net_invest'];
    inputs.forEach(id => {
        el(id).addEventListener('input', calculate);
        if(el(id).tagName === 'SELECT') el(id).addEventListener('change', calculate);
    });

    el('pdfBtn').addEventListener('click', downloadPDF);
    el('resetBtn').addEventListener('click', () => { location.reload(); });

    calculate();
})();
</script>
</body>
</html>
