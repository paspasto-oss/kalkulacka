<!DOCTYPE html>
<html lang="sk">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Porovnávacia kalkulačka vykurovania – Spektra Install</title>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM (UMD) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <!-- Babel (rýchle nasadenie bez build-u) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      html, body { margin:0; padding:0; background:#2e3239; }
      @media print { body { background:#fff !important; } .print\:hidden{display:none!important;} }
    </style>
  </head>
  <body>
    <div id="app-root"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect } = React;

      const fmtEur  = (n) => n.toLocaleString('sk-SK', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 });
      const fmtEur3 = (n) => n.toLocaleString('sk-SK', { style: 'currency', currency: 'EUR', maximumFractionDigits: 3 });

      // Predvolené hodnoty
      const DEFAULTS = {
        heatDemand: 20000,        // kWh/rok tepla
        electricityPrice: 0.16,   // €/kWh
        gasPricePerKWh: 0.09,     // €/kWh paliva
        pelletsPricePerTon: 320,  // €/t
        woodPricePerPrm: 100,     // €/prm
        hpSCOP: 3.8,              // sezónny COP
        effElectric: 1.0,         // el. kotol
        effGas: 0.92,             // plyn
        effPellets: 0.88,         // pelety
        effWood: 0.80,            // drevo
        pelletsKWhPerTon: 4800,   // kWh/t
        woodKWhPerPrm: 1900,      // kWh/prm
        fveSharePct: 0,           // % spotreby TČ z FVE
        fvePrice: 0.00,           // €/kWh vlastnej FVE
      };

      const STORAGE_KEY = 'heating_calc_inputs_v1';

      const Card = ({ title, subtitle, children }) => (
        <div className="rounded-xl border border-black/20 bg-[#444] text-white p-4 shadow-sm">
          <div className="mb-2">
            <div className="font-semibold">{title}</div>
            {subtitle && <div className="text-xs text-slate-300">{subtitle}</div>}
          </div>
          {children}
        </div>
      );

      const NumberRow = ({ label, value, onChange, step=1, decimals=0, hint }) => (
        <label className="flex flex-col gap-1 mb-2">
          <span className="text-sm text-slate-200">{label}</span>
          <input
            type="number"
            step={step}
            value={value}
            onChange={(e)=>onChange(Number(e.target.value))}
            className="px-3 py-2 rounded-xl border border-white/10 bg-[#555] text-white outline-none focus:ring-2 focus:ring-blue-500"
          />
          {hint && <span className="text-[11px] text-slate-400">{hint}</span>}
        </label>
      );

      function HeatingCalculator(){
        // Load z URL alebo localStorage
        const [inputs, setInputs] = useState(()=>{
          try{
            const qs = new URLSearchParams(location.search);
            if(qs.size){
              const base = {...DEFAULTS};
              for(const [k,v] of qs.entries()) if(k in base) base[k]=Number(v);
              return base;
            }
            const raw = localStorage.getItem(STORAGE_KEY);
            return raw ? { ...DEFAULTS, ...JSON.parse(raw) } : DEFAULTS;
          }catch{ return DEFAULTS; }
        });

        const [company] = useState({
          name: 'Spektra Install',
          sidlo: 'Rajecká Lesná 98, 013 15',
          prevadzka: 'Hollého 210, Rajec 01501',
          web: 'www.spektrainstall.sk',
          phone: '+421 917 572 221',
          email: 'spektrainstall@gmail.com',
        });

        useEffect(()=>{ localStorage.setItem(STORAGE_KEY, JSON.stringify(inputs)); }, [inputs]);

        // Efektívna cena el. pre TČ s FVE blendingom
        const hpElecPrice = useMemo(()=>{
          const share = Math.min(Math.max(inputs.fveSharePct/100,0),1);
          return inputs.electricityPrice*(1-share) + inputs.fvePrice*share;
        }, [inputs.electricityPrice, inputs.fveSharePct, inputs.fvePrice]);

        // Výsledky
        const results = useMemo(()=>{
          const heat = inputs.heatDemand;
          const priceHPkWh     = hpElecPrice / inputs.hpSCOP;
          const priceEleckWh   = inputs.electricityPrice / inputs.effElectric; // = electricityPrice
          const priceGaskWh    = inputs.gasPricePerKWh / inputs.effGas;
          const pricePelletkWh = inputs.pelletsPricePerTon / (inputs.pelletsKWhPerTon * inputs.effPellets);
          const priceWoodkWh   = inputs.woodPricePerPrm / (inputs.woodKWhPerPrm * inputs.effWood);

          const rows = [
            { key:'hp',      label:'Tepelné čerpadlo',   cpk:priceHPkWh,     annual:priceHPkWh*heat,     note:`SCOP ${inputs.hpSCOP}` },
            { key:'elec',    label:'Elektrický kotol',   cpk:priceEleckWh,   annual:priceEleckWh*heat,   note:`účinnosť ${(inputs.effElectric*100).toFixed(0)}%` },
            { key:'gas',     label:'Plynový kotol',      cpk:priceGaskWh,    annual:priceGaskWh*heat,    note:`účinnosť ${(inputs.effGas*100).toFixed(0)}%` },
            { key:'pellets', label:'Kotol na pelety',    cpk:pricePelletkWh, annual:pricePelletkWh*heat, note:`účinnosť ${(inputs.effPellets*100).toFixed(0)}%` },
            { key:'wood',    label:'Kotol na drevo',     cpk:priceWoodkWh,   annual:priceWoodkWh*heat,   note:`účinnosť ${(inputs.effWood*100).toFixed(0)}%` },
          ];
          rows.sort((a,b)=>a.annual-b.annual);
          return rows;
        }, [inputs, hpElecPrice]);

        const cheapestKey = results[0]?.key;

        const set = (patch)=>setInputs(s=>({ ...s, ...patch }));
        const doReset = ()=>setInputs(DEFAULTS);
        const doPrint = ()=>window.print();

        return (
          <div className="text-white">
            <div className="max-w-6xl mx-auto px-4 py-6">
              {/* HLAVIČKA – tmavá, väčšie písmo */}
              <div className="rounded-2xl overflow-hidden border border-black/30 shadow-sm">
                <div className="bg-[#111] px-5 py-4">
                  <div className="text-2xl md:text-3xl font-extrabold tracking-tight">{company.name}</div>
                  <div className="text-sm md:text-base text-slate-300">Sídlo: {company.sidlo} • Prevádzka: {company.prevadzka}</div>
                  <div className="text-sm md:text-base text-slate-300">{company.web} • {company.phone} • {company.email}</div>
                </div>
                <div className="bg-[#333] px-5 py-4">
                  <h1 className="text-xl md:text-2xl font-bold tracking-tight">Porovnávacia kalkulačka vykurovania</h1>
                  <p className="text-sm md:text-base text-slate-200/90">Elektrický kotol • Drevo • Tepelné čerpadlo • Plyn • Pelety</p>
                </div>
              </div>

              {/* OVLÁDANIE */}
              <div className="mt-3 flex gap-2 print:hidden">
                <button onClick={doPrint} className="px-3 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700 shadow-sm">Stiahnuť PDF</button>
                <button onClick={doReset} className="px-3 py-2 rounded-lg bg-slate-500 hover:bg-slate-600 text-white">Reset</button>
              </div>

              {/* VSTUPY – tmavé karty */}
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3 mt-3">
                <Card title="Ročná potreba tepla" subtitle="kWh/rok (kúrenie+TÚV)">
                  <NumberRow label="Teplo (kWh/rok)" value={inputs.heatDemand} step={500} onChange={(v)=>set({heatDemand:v})} />
                </Card>

                <Card title="Elektrina">
                  <NumberRow label="Cena elektriny (€/kWh)" value={inputs.electricityPrice} step={0.01} decimals={3} onChange={(v)=>set({electricityPrice:v})} />
                  <NumberRow label="Účinnosť el. kotla" value={inputs.effElectric} step={0.01} decimals={2} onChange={(v)=>set({effElectric:v})} hint="typicky 1.00" />
                </Card>

                <Card title="Tepelné čerpadlo" subtitle="SCOP a vplyv FVE">
                  <NumberRow label="SCOP (sezónny)" value={inputs.hpSCOP} step={0.1} decimals={1} onChange={(v)=>set({hpSCOP:v})} />
                  <div className="mt-1 text-[12px] text-slate-300">Tip: podlahovka 35–40 °C ≈ 3.8–4.5, radiátory 50–55 °C ≈ 2.8–3.5</div>
                  <div className="mt-2 border-t border-white/10 pt-2">
                    <NumberRow label="Pokrytie TČ z FVE (%)" value={inputs.fveSharePct} step={5} decimals={0} onChange={(v)=>set({fveSharePct:v})} />
                    <NumberRow label="Cena vlastnej FVE (€/kWh)" value={inputs.fvePrice} step={0.01} decimals={3} onChange={(v)=>set({fvePrice:v})} hint="ak 0, tak zdarma" />
                    <div className="text-[12px] text-slate-300">Efektívna cena el. pre TČ: {fmtEur3(hpElecPrice)} /kWh</div>
                  </div>
                </Card>

                <Card title="Plynový kotol">
                  <NumberRow label="Cena plynu (€/kWh paliva)" value={inputs.gasPricePerKWh} step={0.005} decimals={3} onChange={(v)=>set({gasPricePerKWh:v})} />
                  <NumberRow label="Účinnosť kotla" value={inputs.effGas} step={0.01} decimals={2} onChange={(v)=>set({effGas:v})} hint="kondenzačný ~0.90–0.98" />
                </Card>

                <Card title="Kotol na pelety">
                  <NumberRow label="Cena peliet (€/t)" value={inputs.pelletsPricePerTon} step={10} onChange={(v)=>set({pelletsPricePerTon:v})} />
                  <NumberRow label="Výhrevnosť (kWh/t)" value={inputs.pelletsKWhPerTon} step={100} onChange={(v)=>set({pelletsKWhPerTon:v})} />
                  <NumberRow label="Účinnosť kotla" value={inputs.effPellets} step={0.01} decimals={2} onChange={(v)=>set({effPellets:v})} />
                </Card>

                <Card title="Kotol na drevo">
                  <NumberRow label="Cena dreva (€/prm)" value={inputs.woodPricePerPrm} step={5} onChange={(v)=>set({woodPricePerPrm:v})} />
                  <NumberRow label="Výhrevnosť (kWh/prm)" value={inputs.woodKWhPerPrm} step={50} onChange={(v)=>set({woodKWhPerPrm:v})} />
                  <NumberRow label="Účinnosť kotla" value={inputs.effWood} step={0.01} decimals={2} onChange={(v)=>set({effWood:v})} />
                </Card>
              </div>

              {/* VÝSLEDKY */}
              <section className="mt-4">
                <h2 className="text-lg font-semibold text-white mb-2">Výsledky – cena tepla a ročné náklady</h2>
                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3">
                  {results.map((r)=>(
                    <div key={r.key} className={`rounded-xl border border-black/20 bg-[#444] text-white p-4 shadow-sm ${r.key===cheapestKey ? 'ring-2 ring-green-500' : ''}`}>
                      <div className="flex items-center justify-between mb-2">
                        <h3 className="font-bold text-base">{r.label}</h3>
                        {r.key===cheapestKey && <span className="text-[11px] px-2 py-0.5 rounded-full bg-green-200 text-green-800">Najlacnejšie</span>}
                      </div>
                      <div className="text-xs text-slate-300 mb-2">{r.note}</div>
                      <div className="text-xs text-slate-200">Cena tepla:</div>
                      <div className="text-xl font-semibold">{fmtEur3(r.cpk)} <span className="text-[13px] font-normal text-slate-300">/ kWh</span></div>
                      <div className="mt-2 text-xs text-slate-200">Ročné náklady (pri {inputs.heatDemand.toLocaleString('sk-SK')} kWh):</div>
                      <div className="text-lg font-semibold">{fmtEur(r.annual)}</div>
                    </div>
                  ))}
                </div>
              </section>

              <footer className="mt-4 text-center text-xs text-slate-300">
                © {new Date().getFullYear()} {company.name} • {company.prevadzka} • {company.phone} • {company.web}
              </footer>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('app-root')).render(<HeatingCalculator />);
    </script>

    <!-- Auto-resize pre iframe (posiela výšku rodičovi a reaguje na požiadavku) -->
    <script>
      (function () {
        function postHeight() {
          const h = document.documentElement.scrollHeight || document.body.scrollHeight || 0;
          parent.postMessage({ type: 'spektra:resize', height: h }, '*');
        }
        window.addEventListener('load', postHeight);
        window.addEventListener('resize', postHeight);

        // Sleduj zmeny DOM (pri prepisoch vstupov)
        const mo = new MutationObserver(() => {
          clearTimeout(window.__spektraTO);
          window.__spektraTO = setTimeout(postHeight, 50);
        });
        mo.observe(document.documentElement, { childList: true, subtree: true, attributes: true });

        // Odpoveď na žiadosť rodiča
        window.addEventListener('message', (e) => {
          if (!e.data || e.data.type !== 'spektra:requestHeight') return;
          postHeight();
        });
      })();
    </script>
  </body>
</html>
